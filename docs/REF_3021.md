# HermesX 302.1 Emergency 協議摘要

## 介面與封包
- SOS / SAFE / STATUS / NEED / RESOURCE / HEARTBEAT 皆走 Emergency 專用 port（HermesX 定義 `PORTNUM_HERMESX_EMERGENCY=300`）。
- SAFE 必須要求 ACK；ACK 收到前維持 EM 封鎖；NACK/超時可重試。
- 文本 port `TEXT_MESSAGE_APP` 不用於 EM 流程（避免被 EMACT 封鎖）。

## 流程
1. 觸發：`@EmergencyActive`（白名單或 passphrase），Lighthouse 設 `emergencyAwaitingSafe=true` 並重啟/進入 EM。
2. 封鎖：`emergencyAwaitingSafe` 為真時，封鎖所有 `TEXT_MESSAGE_APP`（外部/本地）。
3. SAFE 回報：長按 SAFE → 送 Emergency SAFE（port 300，payload "SAFE"，want_ack=true）。
4. 解鎖：收到 SAFE 的 ACK 後清除 `emergencyAwaitingSafe`，退出 EM（目前實作為重啟回一般模式）。
5. NACK/超時：維持封鎖，可再次長按 SAFE 重試。

## 節點需求
- 對端需支援 Meshtastic 路由並接受 port 300 的 Emergency 封包，才能回 ACK；任意不支援的設備無法解除封鎖。

## 目標行為
- EM 期間阻擋所有一般文字；僅允許 Emergency/控制封包。
- SAFE 收到 ACK 前不得退出 EM；收到 ACK 後自動解鎖並切回一般模式。
